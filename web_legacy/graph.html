<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <link rel="stylesheet" href="__GRAPH_CSS__"/>
</head>
<body>
  <div id="toolbar">
    <div id="toolbar-left">
      <label class="layer-toggle" data-layer="family_hub"><input type="checkbox" id="layer-family-hub" checked> Family Hubs</label>
      <label class="layer-toggle" data-layer="family"><input type="checkbox" id="layer-family" checked> Family Gate</label>
      <label class="layer-toggle" data-layer="reference"><input type="checkbox" id="layer-reference"> Linked Notes</label>
      <label class="layer-toggle" data-layer="mass_linker"><input type="checkbox" id="layer-mass-linker"> Mass Linker</label>
        <label class="layer-toggle" data-layer="example"><input type="checkbox" id="layer-example"> Example Gate</label>
        <label class="layer-toggle" data-layer="kanji"><input type="checkbox" id="layer-kanji"> Kanji Gate</label>
        <label class="layer-toggle"><input type="checkbox" id="toggle-unlinked"> Show Unlinked</label>
    </div>
    <div id="toolbar-center">
      <div id="deck-controls">
        <div id="deck-dropdown" class="dropdown">
          <div id="deck-trigger" class="dropdown-trigger">Decks</div>
          <div id="deck-menu" class="dropdown-menu"></div>
        </div>
          <div class="search-wrap">
            <div class="search-input">
              <input id="note-search" type="text" placeholder="Search note..." />
              <div id="search-suggest"></div>
            </div>
            <button id="btn-search" class="btn-settings" type="button">Search</button>
          </div>
      </div>
    </div>
    <div id="toolbar-right">
      <button id="btn-settings" class="btn-settings" type="button">Settings</button>
      <button id="btn-rebuild" class="btn-rebuild" type="button" onclick="pycmd('refresh')">Rebuild</button>
    </div>
  </div>
  <div id="canvas-wrap">
    <div id="graph"></div>
  </div>
  <div id="fallback">Graph loading...</div>
  <div id="tooltip"></div>
  <div id="zoom-controls">
    <button id="zoom-in" type="button" class="zoom-btn">+</button>
    <button id="zoom-out" type="button" class="zoom-btn">-</button>
  </div>
  <div id="zoom-indicator">Zoom: 1.00x</div>
  <div id="debug-panel">
    <label class="debug-toggle" data-debug="shadow_canvas"><input type="checkbox" id="debug-shadow-canvas"> Shadow Canvas</label>
    <label class="debug-toggle" data-debug="link_labels"><input type="checkbox" id="debug-link-labels"> Link Lengths</label>
    <label class="debug-toggle" data-debug="engine_panel"><input type="checkbox" id="debug-engine-panel"> Engine Panel</label>
    <label class="debug-toggle" data-debug="reheat_guard"><input type="checkbox" id="debug-reheat-guard"> Reheat Guard</label>
    <label class="debug-toggle"><input type="checkbox" id="debug-mst"> MST Filter</label>
    <label class="debug-toggle"><input type="checkbox" id="debug-kanji-topk"> Kanji Top-K</label>
    <div class="debug-row" id="debug-kanji-topk-row">
      <span>Top-K</span>
      <input id="debug-kanji-topk-range" type="range" min="1" max="100" step="1">
      <input id="debug-kanji-topk-num" type="number" min="1" max="100" step="1">
    </div>
    <button id="debug-devtools" class="debug-action" type="button">DevTools</button>
    <button id="debug-reheat" class="debug-action" type="button">Reheat</button>
    <button id="debug-stop" class="debug-action" type="button">Stop</button>
    <div id="debug-toasts-wrap" class="debug-section">
      <button id="debug-toasts-toggle" class="debug-section-toggle" type="button">
        <span class="label">Debug Toasts</span>
        <span class="chevron">▾</span>
      </button>
      <div id="debug-toasts-body" class="debug-section-body">
        <label class="debug-toggle" data-debug="debug_toasts"><input type="checkbox" id="debug-toasts"> Enable</label>
        <div id="debug-levels" class="debug-levels"></div>
        <div id="debug-categories" class="debug-categories"></div>
      </div>
    </div>
    <div id="debug-perf" class="debug-perf">
      <span class="label">Perf</span>
      <span class="debug-perf-fps">-- fps</span>
      <span class="debug-perf-ms">-- ms</span>
    </div>
  </div>
  <div id="debug-engine" class="debug-engine">
    <div class="debug-engine-row">
      <span class="label">Engine</span>
      <span class="debug-engine-status">--</span>
    </div>
    <div class="debug-engine-row">
      <span class="label">Forces</span>
      <span class="debug-engine-forces">--</span>
    </div>
    <div class="debug-engine-row">
      <span class="label">Flags</span>
      <span class="debug-engine-flags">--</span>
    </div>
  </div>
  <div id="toast-container"></div>
  <div id="settings-panel">
  <div id="settings-tabs">
      <div class="settings-tab active" data-tab="links">Link Settings</div>
      <div class="settings-tab" data-tab="notes">Note Settings</div>
      <div class="settings-tab" data-tab="cards">Card Settings</div>
      <div class="settings-tab" data-tab="physics">Physics Settings</div>
    </div>
    <div id="settings-notes" class="settings-pane active">
      <div id="note-type-list"></div>
      <div class="phys-divider"></div>
      <div id="note-zoom-settings">
        <div class="phys-row"><span title="Labels visible from this zoom.">Label Min Zoom</span><input id="zoom-label-min" type="range" min="0.5" max="6" step="0.1"><input id="zoom-label-min-num" type="number" min="0.5" max="6" step="0.1"></div>
        <div class="phys-row"><span title="Fade band around label min zoom.">Label Fade Band</span><input id="zoom-label-fade" type="range" min="0" max="1.5" step="0.05"><input id="zoom-label-fade-num" type="number" min="0" max="1.5" step="0.05"></div>
      </div>
    </div>
    <div id="settings-cards" class="settings-pane">
      <div id="card-settings"></div>
      <div class="phys-divider"></div>
      <div id="card-zoom-settings">
        <div class="phys-row"><span title="Card dots visible from this zoom.">Card Min Zoom</span><input id="zoom-card-min" type="range" min="0.5" max="6" step="0.1"><input id="zoom-card-min-num" type="number" min="0.5" max="6" step="0.1"></div>
        <div class="phys-row"><span title="Fade band around card dot min zoom.">Card Fade Band</span><input id="zoom-card-fade" type="range" min="0" max="1.5" step="0.05"><input id="zoom-card-fade-num" type="number" min="0" max="1.5" step="0.05"></div>
      </div>
    </div>
    <div id="settings-links" class="settings-pane">
      <div id="layer-color-list"></div>
      <div class="phys-divider"></div>
      <div id="link-zoom-settings">
        <div class="phys-row"><span title="Particles visible from this zoom.">Flow Min Zoom</span><input id="zoom-flow-min" type="range" min="0.5" max="6" step="0.1"><input id="zoom-flow-min-num" type="number" min="0.5" max="6" step="0.1"></div>
        <div class="phys-row"><span title="Fade band around flow min zoom.">Flow Fade Band</span><input id="zoom-flow-fade" type="range" min="0" max="1.5" step="0.05"><input id="zoom-flow-fade-num" type="number" min="0" max="1.5" step="0.05"></div>
      </div>
    </div>
    <div id="settings-physics" class="settings-pane">
      <div class="phys-row"><span title="Repulsion between nodes. More negative = further apart.">Charge (Repulsion)</span><input id="phys-charge" type="range" min="-200" max="0" step="1"><input id="phys-charge-num" type="number" min="-200" max="0" step="1"></div>
      <div class="phys-row"><span title="Damping of movement per tick. Higher = less bounce.">Velocity Decay</span><input id="phys-vel-decay" type="range" min="0.01" max="1" step="0.01"><input id="phys-vel-decay-num" type="number" min="0.01" max="1" step="0.01"></div>
      <div class="phys-row"><span title="How fast the simulation cools down. Higher = settles sooner.">Alpha Decay</span><input id="phys-alpha-decay" type="range" min="0.001" max="0.2" step="0.001"><input id="phys-alpha-decay-num" type="number" min="0.001" max="0.2" step="0.001"></div>
      <div class="phys-row"><span title="Center pull via d3.forceX/Y (0 disables).">Center Pull</span><input id="phys-center-force" type="range" min="0" max="1" step="0.01"><input id="phys-center-force-num" type="number" min="0" max="1" step="0.01"></div>
      <div class="phys-row"><span title="Max range where repulsion affects other nodes.">Repulsion Range</span><input id="phys-max-radius" type="range" min="300" max="5000" step="50"><input id="phys-max-radius-num" type="number" min="300" max="5000" step="50"></div>
      <div class="phys-row"><span title="Max ticks before simulation stops. Lower = stops earlier.">Cooldown Ticks</span><input id="phys-cooldown" type="range" min="0" max="300" step="1"><input id="phys-cooldown-num" type="number" min="0" max="300" step="1"></div>
      <div class="phys-row"><span title="Max time before simulation stops (ms). Max = ∞.">Cooldown Time</span><input id="phys-cooldown-time" type="range" min="0" max="60000" step="250"><input id="phys-cooldown-time-num" type="number" min="0" max="60000" step="250"></div>
      <div class="phys-row"><span title="Extra ticks at start to stabilize layout.">Warmup Ticks</span><input id="phys-warmup" type="range" min="0" max="200" step="1"><input id="phys-warmup-num" type="number" min="0" max="200" step="1"></div>
      <div class="phys-divider"></div>
      <div class="phys-section-title">Neighbor Scaling</div>
      <div id="neighbor-scaling-settings"></div>
      <div class="phys-divider"></div>
      <div class="phys-section-title">Link Refinement</div>
      <div id="link-refine-settings"></div>
      <div class="phys-row"><button id="phys-reset" type="button">Reset</button></div>
    </div>
  </div>
  <div id="ctx-menu"></div>
  <script src="__FORCE_GRAPH_SRC__"></script>
  <script src="__GRAPH_JS__"></script>
</body>
</html>
