<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>AJpC Tools Graph</title>
  <link rel="stylesheet" href="__GRAPH_CSS__"/>
</head>
<body>
  <div id="app">
    <header id="toolbar">
      <div id="toolbar-left">
        <div id="layer-pills" class="chip-row"></div>
      </div>
      <div id="toolbar-center">
        <div id="search-wrap">
          <input id="search-input" type="text" placeholder="Search node..." autocomplete="off"/>
          <button id="search-go" type="button">Find</button>
          <div id="search-suggest"></div>
        </div>
      </div>
      <div id="toolbar-right">
        <button id="btn-ai-create" type="button">Create</button>
        <button id="btn-fit" type="button">Fit</button>
        <div id="toolbar-debug" class="hidden" aria-hidden="true">
          <button id="btn-dev-tools" type="button">DevTools</button>
          <button id="btn-reload-css" type="button">Reload CSS</button>
        </div>
        <button id="btn-settings" type="button">Settings</button>
        <button id="btn-refresh" type="button">Rebuild</button>
      </div>
    </header>

    <main id="main-layout">
      <div id="status-overlay-top-left">
        <div id="statusbar">
          <span id="status-summary">Nodes: 0 | Edges: 0</span>
          <span id="status-extra-text"></span>
        </div>

        

        <div id="status-active">
          <span id="status-active-details"></span>
          <span id="status-active-cards"></span>
          <span id="status-active-deptree"></span>
          <div class="btn-row">
            <button id="btn-editor" type="button">Editor</button>
          </div>
        </div>

      </div>

      <aside id="editor-panel" class="closed" aria-hidden="true">
      </aside>  

      <section id="graph-panel">
        <div id="graph"></div>
        <div id="graph-empty">Graph loading...</div>
        <div id="hover-tip"></div>
        <div id="ctx-menu"></div>
        <template id="ctx-menu-open-group-template">
          <div class="ctx-group" data-ctx-group="open">
            <div class="item" data-ctx-action="preview">Open Preview</div>
            <div class="item" data-ctx-action="editor">Open Editor</div>
            <div class="item" data-ctx-action="browser">Open Browser</div>
            <div class="item ctx-item-ai-enrich" data-ctx-action="ai-enrich">AI Enrich...</div>
          </div>
        </template>
      </section>

      <aside id="settings-panel" class="closed" aria-hidden="true">

        <div id="settings-head">
          <div class="panel-head">
            <h2>Settings</h2>
            <button id="btn-close-settings" type="button">Close</button>
          </div>
          <div id="settings-tabs">
            <button class="settings-tab active" type="button" data-tab="notes">Notes</button>
            <button class="settings-tab" type="button" data-tab="links">Links</button>
            <button class="settings-tab" type="button" data-tab="physics">Physics</button>
          </div>
        </div>

        <div class="settings-scroll">
          <section id="tab-notes" class="tab-pane active">
            <section class="settings-block">
              <h3>Runtime Filters</h3>
              <div id="note-runtime-settings" class="stack">
                <label class="line-item">
                  <input id="toggle-unlinked" type="checkbox"/>
                  <span>Show unlinked nodes</span>
                </label>
                <span id="node-settings"></span>
              </div>
            </section>

            <section class="settings-block">
              <h3>Note Types</h3>
              <p class="hint">All fields here are now wired for persistence.</p>
              <div id="note-type-list" class="stack"></div>
            </section>
          </section>

          <section id="tab-links" class="tab-pane">
            <section class="settings-block">
              <h3>Link Settings</h3>
              <div id="link-runtime-settings" class="stack">
                <span id="link-settings"></span>
              </div>
            </section>
            <section class="settings-block">
              <h3>Link Layers</h3>
              <div id="link-layer-list" class="stack"></div>
            </section>
            
          </section>

          <section id="tab-physics" class="tab-pane">
            <section class="settings-block">
              <h3>Engine</h3>
              <div id="engine-list" class="stack"></div>
            </section>
            <section class="settings-block">
              <h3>Solver</h3>
              <div id="solver-list" class="stack"></div>
            </section>
            <section class="settings-block">
              <h3>Renderer</h3>
              <div id="renderer-list" class="stack"></div>
            </section>
          </section>
        </div>
      </aside>      

      <div id="status-overlay-bottom-right">
        <div id="status-zoom-pill">
          <span id="status-zoom">Zoom: 1.00x</span>
        </div>


        <div id="status-debug-panel" class="is-hidden">
          <span class="title">Debug mode: On</span>
          <span id="debug-extra"></span>
          <span id="debug-coords"></span>
        </div>
      </div>

      <div id="graph-ai-create-dialog" class="graph-ai-dialog is-hidden" aria-hidden="true">
        <div class="graph-ai-dialog__backdrop"></div>
        <section class="graph-ai-dialog__window graph-ai-dialog__window--create" role="dialog" aria-modal="true" aria-labelledby="graph-ai-create-title">
          <header class="graph-ai-dialog__head">
            <h2 id="graph-ai-create-title">Create Card</h2>
            <button id="graph-ai-create-close" type="button" class="graph-ai-btn graph-ai-btn--ghost">Close</button>
          </header>

          <div class="graph-ai-dialog__content">
            <section class="graph-ai-block graph-ai-block--input">
              <h3>Input</h3>
              <div class="graph-ai-form-row">
                <label for="graph-ai-create-kind">Kind</label>
                <select id="graph-ai-create-kind">
                  <option value="word">Word</option>
                  <option value="sentence">Sentence</option>
                  <option value="text">Text</option>
                  <option value="list">List</option>
                </select>
              </div>
              <div class="graph-ai-form-row graph-ai-form-row--column">
                <label for="graph-ai-create-text">Text</label>
                <textarea id="graph-ai-create-text" rows="4" placeholder="Input word/sentence/text/list here..."></textarea>
              </div>
            </section>

            <div class="graph-ai-actions">
              <button id="graph-ai-create-prereq" type="button" class="graph-ai-btn">Prereq Check</button>
              <button id="graph-ai-create-preview" type="button" class="graph-ai-btn">Preview Create</button>
              <button id="graph-ai-create-reject-mnemonic" type="button" class="graph-ai-btn">Reject Mnemonic</button>
              <button id="graph-ai-create-apply" type="button" class="graph-ai-btn graph-ai-btn--accent">Apply</button>
            </div>

            <div class="graph-ai-nav">
              <div class="graph-ai-nav__left">
                <button id="graph-ai-create-prev" type="button" class="graph-ai-btn graph-ai-btn--ghost">Prev</button>
                <button id="graph-ai-create-next" type="button" class="graph-ai-btn graph-ai-btn--ghost">Next</button>
                <span id="graph-ai-create-result-status">Result: -</span>
              </div>
              <div class="graph-ai-nav__right">
                <label for="graph-ai-create-preview-mode">Mode</label>
                <select id="graph-ai-create-preview-mode">
                  <option value="json">AI JSON</option>
                  <option value="fields">Mapped Fields</option>
                  <option value="template">Template</option>
                </select>
              </div>
            </div>

            <p id="graph-ai-create-perf" class="graph-ai-perf">Perf: -</p>

            <div class="graph-ai-create-layout">
              <aside class="graph-ai-pane graph-ai-pane--prereq">
                <h4>Prereq candidates (EXISTS/NEW)</h4>
                <ul id="graph-ai-create-prereq-list" class="graph-ai-list"></ul>
              </aside>

              <section class="graph-ai-pane graph-ai-pane--preview">
                <h4>Preview</h4>
                <div id="graph-ai-create-preview-json" class="graph-ai-preview-box">
                  <pre>{}</pre>
                </div>
                <div id="graph-ai-create-preview-fields" class="graph-ai-preview-box is-hidden">
                  <table class="graph-ai-field-table">
                    <thead>
                      <tr><th>Field</th><th>Value</th></tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
                <div id="graph-ai-create-preview-template" class="graph-ai-preview-box is-hidden">
                  <div class="graph-ai-template-tabs">
                    <button id="graph-ai-create-template-front" type="button" class="graph-ai-btn graph-ai-btn--ghost">Front</button>
                    <button id="graph-ai-create-template-back" type="button" class="graph-ai-btn graph-ai-btn--ghost">Back</button>
                  </div>
                  <div class="graph-ai-template-canvas">Template Preview</div>
                </div>
              </section>

              <aside class="graph-ai-pane graph-ai-pane--results">
                <h4>Results</h4>
                <ul id="graph-ai-create-results-list" class="graph-ai-list"></ul>
              </aside>
            </div>
          </div>
        </section>
      </div>

      <div id="graph-ai-enrich-dialog" class="graph-ai-dialog is-hidden" aria-hidden="true">
        <div class="graph-ai-dialog__backdrop"></div>
        <section class="graph-ai-dialog__window graph-ai-dialog__window--enrich" role="dialog" aria-modal="true" aria-labelledby="graph-ai-enrich-title">
          <header class="graph-ai-dialog__head">
            <h2 id="graph-ai-enrich-title">Enrich Note</h2>
            <button id="graph-ai-enrich-close" type="button" class="graph-ai-btn graph-ai-btn--ghost">Close</button>
          </header>

          <div class="graph-ai-dialog__content">
            <section class="graph-ai-block graph-ai-block--enrich-input">
              <h3>Existing note</h3>
              <div class="graph-ai-form-row">
                <label for="graph-ai-enrich-nid">NID</label>
                <input id="graph-ai-enrich-nid" type="text" placeholder="Note NID"/>
              </div>
              <div class="graph-ai-form-row">
                <label for="graph-ai-enrich-mode">Mode</label>
                <select id="graph-ai-enrich-mode">
                  <option value="correct_all">correct_all</option>
                  <option value="vocab_correct">vocab_correct</option>
                  <option value="examples">examples</option>
                  <option value="mnemonic">mnemonic</option>
                </select>
              </div>
              <div class="graph-ai-actions graph-ai-actions--enrich">
                <button id="graph-ai-enrich-preview" type="button" class="graph-ai-btn">Preview Patch</button>
                <button id="graph-ai-enrich-apply" type="button" class="graph-ai-btn graph-ai-btn--accent">Apply Patch</button>
                <button id="graph-ai-enrich-reject-mnemonic" type="button" class="graph-ai-btn">Reject Mnemonic</button>
              </div>
            </section>

            <div class="graph-ai-nav">
              <div class="graph-ai-nav__left">
                <span id="graph-ai-enrich-status">Patch: -</span>
              </div>
              <div class="graph-ai-nav__right">
                <label for="graph-ai-enrich-preview-mode">Preview</label>
                <select id="graph-ai-enrich-preview-mode">
                  <option value="json">Plain JSON</option>
                  <option value="template">Card Template</option>
                </select>
              </div>
            </div>

            <p id="graph-ai-enrich-perf" class="graph-ai-perf">Perf: -</p>

            <div class="graph-ai-enrich-layout">
              <div id="graph-ai-enrich-preview-json" class="graph-ai-preview-box">
                <pre>{}</pre>
              </div>
              <div id="graph-ai-enrich-preview-template" class="graph-ai-preview-box is-hidden">
                <div class="graph-ai-template-tabs">
                  <button id="graph-ai-enrich-template-front" type="button" class="graph-ai-btn graph-ai-btn--ghost">Front</button>
                  <button id="graph-ai-enrich-template-back" type="button" class="graph-ai-btn graph-ai-btn--ghost">Back</button>
                </div>
                <div class="graph-ai-template-canvas">Template Preview</div>
              </div>
            </div>
          </div>
        </section>
      </div>

      <div id="graph-ai-duplicate-dialog" class="graph-ai-dialog is-hidden" aria-hidden="true">
        <div class="graph-ai-dialog__backdrop"></div>
        <section class="graph-ai-dialog__window graph-ai-dialog__window--duplicate" role="dialog" aria-modal="true" aria-labelledby="graph-ai-duplicate-title">
          <header class="graph-ai-dialog__head">
            <h2 id="graph-ai-duplicate-title">Duplicate detected</h2>
          </header>
          <div class="graph-ai-dialog__content">
            <p class="graph-ai-note">Existing note detected. Choose action:</p>
            <div class="graph-ai-compare">
              <div class="graph-ai-preview-box"><h4>Existing</h4><pre>{}</pre></div>
              <div class="graph-ai-preview-box"><h4>Generated</h4><pre>{}</pre></div>
            </div>
            <div class="graph-ai-actions graph-ai-actions--dialog">
              <button id="graph-ai-duplicate-cancel" type="button" class="graph-ai-btn graph-ai-btn--ghost">Abbrechen</button>
              <button id="graph-ai-duplicate-enrich" type="button" class="graph-ai-btn">Bestehende anreichern</button>
              <button id="graph-ai-duplicate-create" type="button" class="graph-ai-btn graph-ai-btn--accent">Trotzdem neu erstellen</button>
            </div>
          </div>
        </section>
      </div>

      <div id="graph-ai-mnemonic-reject-dialog" class="graph-ai-dialog is-hidden" aria-hidden="true">
        <div class="graph-ai-dialog__backdrop"></div>
        <section class="graph-ai-dialog__window graph-ai-dialog__window--small" role="dialog" aria-modal="true" aria-labelledby="graph-ai-mnemonic-reject-title">
          <header class="graph-ai-dialog__head">
            <h2 id="graph-ai-mnemonic-reject-title">Reject Mnemonic</h2>
          </header>
          <div class="graph-ai-dialog__content">
            <div class="graph-ai-form-row graph-ai-form-row--column">
              <label for="graph-ai-mnemonic-reject-reason">Reason</label>
              <textarea id="graph-ai-mnemonic-reject-reason" rows="4" placeholder="Optional: explain what to improve..."></textarea>
            </div>
            <div class="graph-ai-actions graph-ai-actions--dialog">
              <button id="graph-ai-mnemonic-reject-cancel" type="button" class="graph-ai-btn graph-ai-btn--ghost">Cancel</button>
              <button id="graph-ai-mnemonic-reject-apply" type="button" class="graph-ai-btn graph-ai-btn--accent">Regenerate</button>
            </div>
          </div>
        </section>
      </div>

      <div id="graph-ai-enrich-fields-dialog" class="graph-ai-dialog is-hidden" aria-hidden="true">
        <div class="graph-ai-dialog__backdrop"></div>
        <section class="graph-ai-dialog__window graph-ai-dialog__window--small" role="dialog" aria-modal="true" aria-labelledby="graph-ai-enrich-fields-title">
          <header class="graph-ai-dialog__head">
            <h2 id="graph-ai-enrich-fields-title">Apply Enrich Patch</h2>
          </header>
          <div class="graph-ai-dialog__content">
            <p class="graph-ai-note">Select fields to apply:</p>
            <ul id="graph-ai-enrich-fields-list" class="graph-ai-list"></ul>
            <div class="graph-ai-actions graph-ai-actions--dialog">
              <button id="graph-ai-enrich-fields-cancel" type="button" class="graph-ai-btn graph-ai-btn--ghost">Cancel</button>
              <button id="graph-ai-enrich-fields-apply" type="button" class="graph-ai-btn graph-ai-btn--accent">Apply</button>
            </div>
          </div>
        </section>
      </div>

    </main>
  </div>
  <script src="__GRAPH_GRAPHOLOGY_SRC__"></script>
  <script src="__GRAPH_LAYOUT_SRC__"></script>
  <script src="__GRAPH_D3_DISPATCH_SRC__"></script>
  <script src="__GRAPH_D3_QUADTREE_SRC__"></script>
  <script src="__GRAPH_D3_TIMER_SRC__"></script>
  <script src="__GRAPH_D3_FORCE_SRC__"></script>
  <script src="__GRAPH_ENGINE_SRC__"></script>

  <script src="__GRAPH_SIGMA_PROGRAM_EDGE_CURVED_JS__"></script>
  <script src="__GRAPH_SIGMA_PROGRAM_EDGE_DASHED_JS__"></script>
  <script src="__GRAPH_SIGMA_PROGRAM_EDGE_DOTTED_JS__"></script>
  <script src="__GRAPH_SIGMA_PROGRAM_NODE_NOTE_JS__"></script>
  <script src="__GRAPH_SIGMA_PROGRAM_NODE_HUB_JS__"></script>
  <script src="__GRAPH_SIGMA_PROGRAM_EXTRA_CARDDOTS_JS__"></script>
  <script src="__GRAPH_SIGMA_PROGRAM_EXTRA_NODEFX_JS__"></script>

  <script src="__GRAPH_STATE_JS__"></script>
  <script src="__GRAPH_BRIDGE_JS__"></script>
  <script src="__GRAPH_ADAPTER_JS__"></script>
  <script src="__GRAPH_CITY_GATEWAY_JS__"></script>
  <script src="__GRAPH_CONTRACTS_JS__"></script>
  <script src="__GRAPH_UTILS_JS__"></script>
  <script src="__GRAPH_PAYLOAD_JS__"></script>
  <script src="__GRAPH_FLOW_JS__"></script>
  <script src="__GRAPH_ENGINE_GATEWAY_JS__"></script>
  <script src="__GRAPH_ENGINE_JS__"></script>
  <script src="__GRAPH_DATA_JS__"></script>
  <script src="__GRAPH_SOLVER_JS__"></script>
  <script src="__GRAPH_RENDERER_JS__"></script>
  <script src="__GRAPH_UI_DEPTREE_JS__"></script>
  <script src="__GRAPH_UI_DEBUG_JS__"></script>
  <script src="__GRAPH_UI_TOOLTIP_JS__"></script>
  <script src="__GRAPH_UI_CTX_JS__"></script>
  <script src="__GRAPH_UI_EDITOR_JS__"></script>
  <script src="__GRAPH_UI_JS__"></script>
  <script src="__GRAPH_USECASE_ENGINE_PORTS_JS__"></script>
  <script src="__GRAPH_USECASE_PAYLOAD_APPLY_JS__"></script>
  <script src="__GRAPH_USECASE_DELTA_APPLY_JS__"></script>
  <script src="__GRAPH_MAIN_JS__"></script>
</body>
</html>
