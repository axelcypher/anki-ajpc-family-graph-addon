@use "graph.mixins" as mixins;

#toolbar {
  display: grid;
  grid-template-columns: minmax(200px, 1.1fr) minmax(300px, 1fr) auto;
  gap: 12px;
  align-items: center;
  padding: 10px 25px;
  background: var(--ui-surface-base);
}

#toolbar-left,
#toolbar-center,
#toolbar-right {
  min-width: 0;
}

#toolbar-right {
  display: flex;
  gap: 8px;
  justify-content: flex-end;
}




#btn-refresh,
#btn-ai-create {
  @include mixins.interactive-control-inverted(
    $border: var(--control-border-accent-inverted),
    $background: var(--control-bg-accent-inverted)
  );
}

#toolbar-debug {
  @include mixins.button-group();
  button {
    @include mixins.interactive-control-inverted(
      $border: var(--dev-control-border),
      $background: var(--dev-control-bg),
      $radius: 0
    );
  }

  #btn-dev-tools:hover,
  #btn-reload-css:hover {
    border-color: var(--dev-control-border-hover);
    background: var(--dev-control-bg-hover);
  }
}

#search-wrap {
  position: relative;
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 0;

  #search-input-wrap{
    position: relative;
    margin-right: 0;
    #search-input {
      @include mixins.interactive-control(
        $border: var(--ui-surface-card),
        $background: var(--field-surface),
        $hover-border: var(--accent-border),
        $hover-background: var(--field-surface),
      );
      position: absolute;
      inset: 1px;
      border-bottom-right-radius: 0;
      border-top-right-radius: 0;
    }
  }
  #search-go {
    width: 50px;
    margin-left: 1px;
    border-bottom-left-radius: 0;
    border-top-left-radius: 0;
  }
  #search-suggest {
    @include mixins.scrollbar();
    position: absolute;
    top: calc(100% + 0px);
    width: calc(100% - 50px);
    left: 0;
    right: 85px;
    max-height: 260px;
    overflow: auto;
    background: var(--menu-surface-bg);
    border-radius: var(--radius-md);
    z-index: 500;

    &.is-visible {
      display: block;
      border: 1px solid var(--glass-surface-divider);

    }
    .suggest-item {
      padding: 7px 9px;
      border-bottom: 1px solid var(--menu-divider);
      cursor: pointer;

      &:hover,
      &:active {
        background: var(--menu-surface-bg-hover);
        border-bottom: 1px solid var(--accent-base);
      }
      .suggest-meta {
        display: block;
        color: var(--ui-text-secondary);
        font-size: 11px;
      }
    }
  }
}



#settings-panel {
  @include mixins.side-panel-shell($side: right);
  @include mixins.side-panel-notch(
    $side-prop: left,
    $side-value: calc(var(--radius-lg) * -2),
    $top: 0,
    $width: calc(var(--radius-lg) * 2),
    $height: calc(var(--radius-lg) * 2),
    $mask: radial-gradient(
      circle calc(var(--radius-lg) * 2) at 0 100%,
      var(--ui-color-transparent) calc((var(--radius-lg) * 2) - 0px),
      var(--ui-mask-solid) calc(var(--radius-lg) * 2)
    )
  );

  #settings-head {
    height: 12%;
    overflow: auto;
    padding: 12px 12px;
    box-sizing: border-box;
    border-bottom: 1px solid var(--ui-surface-base-border);
    box-shadow: var(--shadow-elevation-1);
    
    .panel-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 12px;

      h2 {
        margin: 0;
        font-size: 18px;
      }
    }

    #settings-tabs {
      @include mixins.button-group($item-selector: "> .settings-tab");
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 0px;
      
      .settings-tab {
        @include mixins.interactive-control(
          $radius: 0,
          $active-border: var(--control-border),
          $active-background: var(--accent-active)
        );
        font-weight: 600;
      }
      .settings-tab.active:hover{
          border: 1px solid var(--accent-border);
          background: var(--accent-base);
      }
    }
  }


  .settings-scroll {
    @include mixins.scrollbar();
    height: 88%;
    min-height: 0;
    overflow: auto;
    padding: 12px 12px;
    box-sizing: border-box;
    border: none;

    .settings-block {
      @include mixins.surface-card(
        $border: var(--ui-surface-base-border),
        $background: var(--ui-surface-card),
        $radius: var(--radius-md),
        $padding: 10px);
      margin-bottom: 10px;

      h3 {
        margin: 0 0 8px 0;
        font-size: 14px;
      }

      #link-runtime-settings,
      #link-runtime-settings #link-settings {
        display: grid;
        gap: 8px;
      }

      #note-type-list .note-type-card,
      #link-layer-list .link-type-card {
        @include mixins.surface-card(
          $border: var(--ui-surface-card-border)
        );
        transition: border-color 180ms ease, background-color 180ms ease;
      }

      #note-type-list .note-type-head,
      #link-layer-list .link-type-head {
        @include mixins.collapsible-head();
      }

      #note-type-list .note-type-body,
      #link-layer-list .link-type-body {
        @include mixins.collapsible-body();
      }

      #note-type-list .note-type-body-inner,
      #link-layer-list .link-type-body-inner {
        @include mixins.collapsible-body-inner();
      }

      #note-type-list .note-type-card {
        @include mixins.collapsible-collapsed(
          $head-selector: ".note-type-head",
          $body-selector: ".note-type-body"
        );

        .line-item {
          @include mixins.row-chip(
            $border: var(--ui-surface-base-border),
            $background: var(--ui-surface-card),
          );
        }

        .note-type-name {
          font-size: 13px;
          font-weight: 700;
        }
      }

      #link-layer-list .link-type-card {
        @include mixins.collapsible-collapsed(
          $head-selector: ".link-type-head",
          $body-selector: ".link-type-body"
        );

        .link-type-name {
          font-size: 13px;
          font-weight: 700;
          cursor: pointer;
        }

        .link-type-head-right {
          display: flex;
          align-items: center;
          gap: 6px;
        }

        .ln-collapse-indicator {
          width: 14px;
          height: 14px;
          cursor: pointer;
          display: inline-grid;
          place-items: center;
          flex: 0 0 14px;

          &::before {
            @include mixins.caret-indicator($rotation: 90deg);
          }
        }

        &:not(.is-collapsed) {
          .link-type-head .ln-collapse-indicator::before {
            transform: rotate(0deg);
          }
        }
      }

      .note-field-grid,
      .link-field-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 1%;
      }

      .note-fields-left,
      .link-fields-left {
        flex: 0 0 29%;
      }

      .note-fields-right,
      .link-fields-right {
        flex: 0 0 69%;
      }

      .note-fields-bottom,
      .link-fields-bottom {
        flex: 0 0 100%;
      }

      .note-fields-bottom select[multiple] {
        @include mixins.scrollbar();
      }

      .link-fields-left {
        display: grid;
        gap: 6px;

        .color-picker {
          border-radius: 0;
          width: 100%;
          height: 10px;
          aspect-ratio: none;
          border: 0;

          input[type="color"] {
            border-radius: 0;
            margin-top: 0;
          }

          input[type="color"]::-webkit-color-swatch-wrapper,
          input[type="color"]::-webkit-color-swatch {
            border-radius: 0;
          }
        }
      }

      .link-fields-right {
        display: grid;
        gap: 6px;
      }

      .ln-ml-group-hubs {
        display: grid;
        gap: 6px;

        .ln-ml-group-list {
          display: grid;
          gap: 4px;

          .ln-ml-group-row {
            @include mixins.row-chip(
              $background: var(--ui-surface-base),
            );
          }
        }
      }

      #engine-list,
      #solver-list,
      #renderer-list {
        .control-row {
          grid-template-columns: 7fr 2fr;
        }
      }
    }

    .tab-pane {
      display: none;

      &.active {
        display: block;
      }
    }
  }
}


#editor-panel {
  @include mixins.side-panel-shell($side: left);
  @include mixins.side-panel-notch(
    $side-prop: right,
    $side-value: calc(var(--radius-lg) * -1),
    $top: 24px,
    $width: var(--radius-lg),
    $height: var(--radius-lg),
    $mask: radial-gradient(
      circle var(--radius-lg) at 100% 100%,
      var(--ui-color-transparent) calc(var(--radius-lg) - 0px),
      var(--ui-mask-solid) var(--radius-lg)
    )
  );
}


